{"version":3,"file":"index.umd.js","sources":["../src/utils/cors.ts","../src/utils/tests.ts","../src/utils/index.ts"],"sourcesContent":["/**\n * Multi purpose CORS lib.\n * Note: Based on the `cors` package in npm but using only\n * web APIs. Feel free to use it in your own projects.\n */\n\ntype StaticOrigin = boolean | string | RegExp | (boolean | string | RegExp)[]\n\ntype OriginFn = (\n  origin: string | undefined,\n  req: Request\n) => StaticOrigin | Promise<StaticOrigin>\n\ninterface CorsOptions {\n  origin?: StaticOrigin | OriginFn\n  methods?: string | string[]\n  allowedHeaders?: string | string[]\n  exposedHeaders?: string | string[]\n  credentials?: boolean\n  maxAge?: number\n  preflightContinue?: boolean\n  optionsSuccessStatus?: number\n}\n\nconst defaultOptions: CorsOptions = {\n  origin: '*',\n  methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n  preflightContinue: false,\n  optionsSuccessStatus: 204,\n}\n\nfunction isOriginAllowed(origin: string, allowed: StaticOrigin): boolean {\n  return Array.isArray(allowed)\n    ? allowed.some((o) => isOriginAllowed(origin, o))\n    : typeof allowed === 'string'\n      ? origin === allowed\n      : allowed instanceof RegExp\n        ? allowed.test(origin)\n        : !!allowed\n}\n\nfunction getOriginHeaders(reqOrigin: string | undefined, origin: StaticOrigin) {\n  const headers = new Headers()\n\n  if (origin === '*') {\n    // Allow any origin\n    headers.set('Access-Control-Allow-Origin', '*')\n  } else if (typeof origin === 'string') {\n    // Fixed origin\n    headers.set('Access-Control-Allow-Origin', origin)\n    headers.append('Vary', 'Origin')\n  } else {\n    const allowed = isOriginAllowed(reqOrigin ?? '', origin)\n\n    if (allowed && reqOrigin) {\n      headers.set('Access-Control-Allow-Origin', reqOrigin)\n    }\n    headers.append('Vary', 'Origin')\n  }\n\n  return headers\n}\n\n// originHeadersFromReq\n\nasync function originHeadersFromReq(\n  req: Request,\n  origin: StaticOrigin | OriginFn\n) {\n  const reqOrigin = req.headers.get('Origin') || undefined\n  const value =\n    typeof origin === 'function' ? await origin(reqOrigin, req) : origin\n\n  if (!value) return\n  return getOriginHeaders(reqOrigin, value)\n}\n\nfunction getAllowedHeaders(req: Request, allowed?: string | string[]) {\n  const headers = new Headers()\n\n  if (!allowed) {\n    allowed = req.headers.get('Access-Control-Request-Headers')!\n    headers.append('Vary', 'Access-Control-Request-Headers')\n  } else if (Array.isArray(allowed)) {\n    // If the allowed headers is an array, turn it into a string\n    allowed = allowed.join(',')\n  }\n  if (allowed) {\n    headers.set('Access-Control-Allow-Headers', allowed)\n  }\n\n  return headers\n}\n\nexport default async function cors(\n  req: Request,\n  res: Response,\n  options?: CorsOptions\n) {\n  const opts = { ...defaultOptions, ...options }\n  const { headers } = res\n  const originHeaders = await originHeadersFromReq(req, opts.origin ?? false)\n  const mergeHeaders = (v: string, k: string) => {\n    if (k === 'Vary') headers.append(k, v)\n    else headers.set(k, v)\n  }\n\n  // If there's no origin we won't touch the response\n  if (!originHeaders) return res\n\n  originHeaders.forEach(mergeHeaders)\n\n  if (opts.credentials) {\n    headers.set('Access-Control-Allow-Credentials', 'true')\n  }\n\n  const exposed = Array.isArray(opts.exposedHeaders)\n    ? opts.exposedHeaders.join(',')\n    : opts.exposedHeaders\n\n  if (exposed) {\n    headers.set('Access-Control-Expose-Headers', exposed)\n  }\n\n  // Handle the preflight request\n  if (req.method === 'OPTIONS') {\n    if (opts.methods) {\n      const methods = Array.isArray(opts.methods)\n        ? opts.methods.join(',')\n        : opts.methods\n\n      headers.set('Access-Control-Allow-Methods', methods)\n    }\n\n    getAllowedHeaders(req, opts.allowedHeaders).forEach(mergeHeaders)\n\n    if (typeof opts.maxAge === 'number') {\n      headers.set('Access-Control-Max-Age', String(opts.maxAge))\n    }\n\n    if (opts.preflightContinue) return res\n\n    headers.set('Content-Length', '0')\n    return new Response(null, { status: opts.optionsSuccessStatus, headers })\n  }\n\n  // If we got here, it's a normal request\n  return res\n}\n\nexport function initCors(options?: CorsOptions) {\n  return (req: Request, res: Response) => cors(req, res, options)\n}","import { Client, buildClient } from '@datocms/cma-client';\nimport { ItemType } from '@datocms/cma-client/dist/types/generated/SimpleSchemaTypes.js';\n\nconst baseApiUrl = `${process.env.NEXT_PUBLIC_SITE_URL}/api`\n\ntype PreviewLink = {\n  label: string\n  url: string\n}\n\ntype RevalidateResponse = {\n  revalidated: boolean,\n  paths: string[]\n  delays: number\n  event_type: string\n}\n\ntype TestResult = {\n  model: string\n  previews?: PreviewLink[]\n  revalidate?: RevalidateResponse\n}\n\nexport async function testApiEndpoints() {\n\n  const client = buildClient({ apiToken: process.env.DATOCMS_API_TOKEN })\n  const site = await client.site.find()\n\n  console.log(`Testing site: ${site.name}`)\n\n  const itemTypes = await client.itemTypes.list()\n  const models = itemTypes.filter(t => !t.modular_block)\n\n  const results = []\n\n  for (let i = 0; i < models.length; i++) {\n    const r: TestResult = { model: models[i].api_key }\n\n    try {\n      const previews = await testWebPreviewsEndpoint(models[i], client)\n      if (previews.length > 0) {\n        r.previews = previews\n      }\n    } catch (e) {\n\n    }\n\n    try {\n      r.revalidate = await testRevalidateEndpoint(models[i], client)\n    } catch (e) {\n      console.log(e)\n    }\n    results.push(r)\n  }\n\n  return results\n}\n\nexport const testResultsToString = (results: TestResult[]) => {\n  const tests = results.map(r => {\n    return `${r.model} - Previews: ${r.previews ? 'YES' : 'NO'} / Revalidate: ${r.revalidate ? 'YES' : 'NO'}`\n  }).join('\\n')\n\n  const previews = results.filter(r => r.previews).map(r => r.model).sort((a, b) => a > b ? 1 : -1).join('\\n')\n  const revalidate = results.filter(r => r.revalidate).map(r => r.model).sort((a, b) => a > b ? 1 : -1).join('\\n')\n  const nopreviews = results.filter(r => !r.previews).map(r => r.model).sort((a, b) => a > b ? 1 : -1).join('\\n')\n  const norevalidate = results.filter(r => !r.revalidate).map(r => r.model).sort((a, b) => a > b ? 1 : -1).join('\\n')\n\n  return `WEB PREVIEWS\\n${previews}\\n\\nNO WEB PREVIEWS:\\n${nopreviews}\\n\\nREVALIDATE\\n${revalidate}\\n\\nNO REVALIDATE\\n${norevalidate}`\n\n}\n\nexport const testResultsToHtml = (results: TestResult[]) => {\n  return `\n    <html>\n      <body>\n        <pre>\n        <table>\n          <thead>\n            <tr>\n              <th>Model</th>\n              <th>Previews</th>\n              <th>Revalidate</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${results.map(r => `\n              <tr>\n                <td>${r.model}</td>\n                <td>${r.previews ? 'x' : '-'}</td>\n                <td>${r.revalidate ? 'x' : '-'}</td>\n              </tr>\n            `).join('')}\n          </tbody>\n        </pre>\n      </body>\n    </html>\n  `\n}\n\nconst testWebPreviewsEndpoint = async (itemType: ItemType, client: Client): Promise<PreviewLink[]> => {\n\n  const item = (await client.items.list({ filter: { type: itemType.api_key } }))[0]\n  const res = await fetch(`${baseApiUrl}/web-previews`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Basic ${btoa(`${process.env.BASIC_AUTH_USER}:${process.env.BASIC_AUTH_PASSWORD}`)}`\n    },\n    body: JSON.stringify({\n      item: {\n        attributes: item || {}\n      },\n      itemType: {\n        attributes: itemType\n      },\n      environmentId: \"main\",\n      locale: \"en\"\n    })\n  })\n\n  const json = await res.json()\n  return json.previewLinks\n\n}\n\nconst testRevalidateEndpoint = async (itemType: ItemType, client: Client): Promise<RevalidateResponse> => {\n\n  const item = (await client.items.list({ filter: { type: itemType.api_key } }))[0]\n  const res = await fetch(`${baseApiUrl}/revalidate`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Basic ${btoa(`${process.env.BASIC_AUTH_USER}:${process.env.BASIC_AUTH_PASSWORD}`)}`\n    },\n    body: JSON.stringify({\n      \"environment\": \"main\",\n      \"entity_type\": \"item\",\n      \"event_type\": \"update\",\n      \"entity\": {\n        \"id\": item.id,\n        \"type\": \"item\",\n        \"attributes\": {\n          ...item || {}\n        },\n        \"relationships\": {\n          \"item_type\": {\n            \"data\": {\n              \"id\": itemType.id,\n              \"type\": \"item_type\"\n            }\n          }\n        },\n        \"meta\": item.meta\n      },\n      \"related_entities\": [\n        {\n          \"id\": itemType.id,\n          \"type\": \"item_type\",\n          \"attributes\": itemType\n        }\n      ],\n    })\n  })\n  if (res.status === 200) {\n    const json = await res.json()\n    return json\n  } else {\n    throw new Error(`Error testing revalidate endpoint: ${res.status} ${res.statusText}`)\n  }\n}","import { ReactNode } from \"react\";\nimport { ApiError, buildClient } from \"@datocms/cma-client\";\nexport { default as cors } from './cors.js'\nexport { testApiEndpoints } from './tests.js'\n\nexport const isServer = typeof window === 'undefined';\n\nexport const chunkArray = (array: any[] | ReactNode[], chunkSize: number) => {\n  const newArr = []\n  for (let i = 0; i < array.length; i += chunkSize)\n    newArr.push(array.slice(i, i + chunkSize));\n  return newArr\n}\n\nexport const parseDatoError = (err: any): string => {\n  const errors = (err as ApiError).errors.map(({ attributes: { code, details } }) => ({ code, field: details?.field, message: details?.message, detailsCode: details?.code, errors: Array.isArray(details?.errors) ? details?.errors.join('. ') : undefined }))\n  return errors.map(({ code, field, message, detailsCode, errors }) => `${code} ${field ? `(${field})` : ''} ${message || ''} ${detailsCode || ''} ${errors ? `(${errors})` : ''}`).join('\\n')\n}\n\nexport const parseDatoCMSApiError = (e: any): string => {\n\n  if (e instanceof ApiError === false)\n    return typeof e === 'string' ? e : e.message || e.toString()\n\n  const err = new ApiError(e)\n  return err.errors.map(e => {\n    let code = `${e.attributes.code}`\n    let errors = []\n\n    if (Array.isArray(e.attributes.details?.errors)) {\n      e.attributes.details.errors.forEach(e => {\n        errors.push(Object.keys(e).map(k => `${k}: ${e[k]}`).join(', '))\n      })\n    }\n    return `${code}${errors.length ? `: ${errors.join('. ')}` : ''}`\n  }).join('\\n')\n}\n\nexport const isEmpty = (obj: any) => Object.keys(obj).filter(k => obj[k] !== undefined).length === 0\n\nexport const capitalize = (str: string, lower: boolean = false) => {\n  return (lower ? str.toLowerCase() : str).replace(/(?:^|\\s|[\"'([{])+\\S/g, match => match.toUpperCase());\n}\n\nexport const sleep = (ms: number) => new Promise((resolve, refject) => setTimeout(resolve, ms))\n\nexport const rInt = (min: number, max: number): number => {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nexport const truncateParagraph = (s: string, sentances: number = 1, ellipsis: boolean = true, minLength = 200): string => {\n  if (!s || s.length < minLength)\n    return s;\n\n  let dotIndex = s.split('.')?.slice(0, sentances + 1).join('.').lastIndexOf('.')\n  let qIndex = s.split('? ')?.slice(0, sentances + 1).join('? ').lastIndexOf('? ')\n  const isQuestion = qIndex !== -1 && qIndex < dotIndex || (dotIndex === -1 && qIndex > -1)\n\n  if (dotIndex === -1 && qIndex === -1) {\n    dotIndex = minLength - 1\n    ellipsis = true\n  }\n\n  let str = s.substring(0, isQuestion ? qIndex : dotIndex) //`${s.substring(0, minLength - 1)}${s.substring(minLength - 1).split('.').slice(0, sentances).join('. ')}`\n  return `${str}${ellipsis ? '...' : isQuestion ? '?' : '.'}`;\n}\n\nexport const truncateWords = (text: string, maxLength: number): string => {\n  if (text.length <= maxLength)\n    return text;\n\n  var truncatedText = text.substring(0, maxLength);\n  var lastSpaceIndex = truncatedText.lastIndexOf(' ');\n  if (lastSpaceIndex !== -1) {\n    truncatedText = truncatedText.substr(0, lastSpaceIndex);\n  }\n  return truncatedText + '...';\n}\n\nexport const sortSwedish = <T>(arr: T[], key?: string): T[] => {\n  const alfabet = [\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"I\", \"J\", \"K\", \"L\", \"M\", \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"U\", \"V\", \"W\", \"X\", \"Y\", \"Z\", \"Å\", \"Ä\", \"Ö\"];\n\n  return arr.sort((a, b) => {\n    const ai = alfabet.findIndex((l) => l === (key ? a[key] : a)?.charAt(0).toUpperCase())\n    const bi = alfabet.findIndex((l) => l === (key ? b[key] : b)?.charAt(0).toUpperCase())\n    return !ai ? -1 : ai > bi ? 1 : ai === bi ? 0 : -1\n  })\n}\n\nexport const awaitElement = async <T>(selector: string) => {\n\n  const cleanSelector = function (selector) {\n    (selector.match(/(#[0-9][^\\s:,]*)/g) || []).forEach(function (n) {\n      selector = selector.replace(n, '[id=\"' + n.replace(\"#\", \"\") + '\"]');\n    });\n    return selector;\n  }\n\n  for (let i = 0; i < 100; i++) {\n    const el = document.querySelector(cleanSelector(selector)) as T\n    if (el) return el\n    await sleep(30)\n  }\n\n  throw new Error(`Element ${selector} not found`)\n}"],"names":["cors","originHeadersFromReq","req","origin","value","reqOrigin","headers","Headers","set","append","isOriginAllowed","getOriginHeaders","get","undefined","Promise","resolve","then","_temp2","defaultOptions","methods","preflightContinue","optionsSuccessStatus","allowed","Array","isArray","some","o","RegExp","test","pact","state","s","_settle","bind","observer","_Pact","prototype","onFulfilled","onRejected","result","this","callback","v","e","_this","baseApiUrl","process","env","NEXT_PUBLIC_SITE_URL","_isSettledPact","thenable","isServer","window","sleep","ms","refject","setTimeout","selector","_exit2","_temp3","_result","Error","_i","_temp4","_for","i","el","document","querySelector","match","forEach","n","replace","cleanSelector","reject","str","lower","toLowerCase","toUpperCase","array","chunkSize","newArr","length","push","slice","res","options","opts","_opts$origin","originHeaders","k","mergeHeaders","credentials","exposed","exposedHeaders","join","method","getAllowedHeaders","allowedHeaders","maxAge","String","Response","status","obj","Object","keys","filter","ApiError","message","toString","errors","map","_e$attributes$details","code","attributes","details","err","_ref$attributes","field","detailsCode","_ref2","min","max","Math","ceil","floor","random","arr","key","sort","a","b","ai","alfabet","findIndex","l","_ref3","charAt","bi","_ref4","buildClient","apiToken","DATOCMS_API_TOKEN","client","site","find","console","log","name","itemTypes","list","body","models","t","modular_block","_temp5","results","r","_temp","_catch","itemType","items","type","api_key","_client$items$list2","item","fetch","Authorization","btoa","BASIC_AUTH_USER","BASIC_AUTH_PASSWORD","JSON","stringify","environment","entity_type","event_type","entity","id","relationships","item_type","data","meta","related_entities","json","statusText","testRevalidateEndpoint","revalidate","model","_client$items$list","environmentId","locale","previewLinks","testWebPreviewsEndpoint","previews","_cycle","sentances","ellipsis","minLength","_s$split","_s$split2","dotIndex","split","lastIndexOf","qIndex","isQuestion","substring","text","maxLength","truncatedText","lastSpaceIndex","substr"],"mappings":"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"}