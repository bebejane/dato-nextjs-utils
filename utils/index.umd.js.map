{"version":3,"file":"index.umd.js","sources":["../src/utils/cors.ts","../src/utils/index.ts"],"sourcesContent":["/**\n * Multi purpose CORS lib.\n * Note: Based on the `cors` package in npm but using only\n * web APIs. Feel free to use it in your own projects.\n */\n\ntype StaticOrigin = boolean | string | RegExp | (boolean | string | RegExp)[]\n\ntype OriginFn = (\n  origin: string | undefined,\n  req: Request\n) => StaticOrigin | Promise<StaticOrigin>\n\ninterface CorsOptions {\n  origin?: StaticOrigin | OriginFn\n  methods?: string | string[]\n  allowedHeaders?: string | string[]\n  exposedHeaders?: string | string[]\n  credentials?: boolean\n  maxAge?: number\n  preflightContinue?: boolean\n  optionsSuccessStatus?: number\n}\n\nconst defaultOptions: CorsOptions = {\n  origin: '*',\n  methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n  preflightContinue: false,\n  optionsSuccessStatus: 204,\n}\n\nfunction isOriginAllowed(origin: string, allowed: StaticOrigin): boolean {\n  return Array.isArray(allowed)\n    ? allowed.some((o) => isOriginAllowed(origin, o))\n    : typeof allowed === 'string'\n      ? origin === allowed\n      : allowed instanceof RegExp\n        ? allowed.test(origin)\n        : !!allowed\n}\n\nfunction getOriginHeaders(reqOrigin: string | undefined, origin: StaticOrigin) {\n  const headers = new Headers()\n\n  if (origin === '*') {\n    // Allow any origin\n    headers.set('Access-Control-Allow-Origin', '*')\n  } else if (typeof origin === 'string') {\n    // Fixed origin\n    headers.set('Access-Control-Allow-Origin', origin)\n    headers.append('Vary', 'Origin')\n  } else {\n    const allowed = isOriginAllowed(reqOrigin ?? '', origin)\n\n    if (allowed && reqOrigin) {\n      headers.set('Access-Control-Allow-Origin', reqOrigin)\n    }\n    headers.append('Vary', 'Origin')\n  }\n\n  return headers\n}\n\n// originHeadersFromReq\n\nasync function originHeadersFromReq(\n  req: Request,\n  origin: StaticOrigin | OriginFn\n) {\n  const reqOrigin = req.headers.get('Origin') || undefined\n  const value =\n    typeof origin === 'function' ? await origin(reqOrigin, req) : origin\n\n  if (!value) return\n  return getOriginHeaders(reqOrigin, value)\n}\n\nfunction getAllowedHeaders(req: Request, allowed?: string | string[]) {\n  const headers = new Headers()\n\n  if (!allowed) {\n    allowed = req.headers.get('Access-Control-Request-Headers')!\n    headers.append('Vary', 'Access-Control-Request-Headers')\n  } else if (Array.isArray(allowed)) {\n    // If the allowed headers is an array, turn it into a string\n    allowed = allowed.join(',')\n  }\n  if (allowed) {\n    headers.set('Access-Control-Allow-Headers', allowed)\n  }\n\n  return headers\n}\n\nexport default async function cors(\n  req: Request,\n  res: Response,\n  options?: CorsOptions\n) {\n  const opts = { ...defaultOptions, ...options }\n  const { headers } = res\n  const originHeaders = await originHeadersFromReq(req, opts.origin ?? false)\n  const mergeHeaders = (v: string, k: string) => {\n    if (k === 'Vary') headers.append(k, v)\n    else headers.set(k, v)\n  }\n\n  // If there's no origin we won't touch the response\n  if (!originHeaders) return res\n\n  originHeaders.forEach(mergeHeaders)\n\n  if (opts.credentials) {\n    headers.set('Access-Control-Allow-Credentials', 'true')\n  }\n\n  const exposed = Array.isArray(opts.exposedHeaders)\n    ? opts.exposedHeaders.join(',')\n    : opts.exposedHeaders\n\n  if (exposed) {\n    headers.set('Access-Control-Expose-Headers', exposed)\n  }\n\n  // Handle the preflight request\n  if (req.method === 'OPTIONS') {\n    if (opts.methods) {\n      const methods = Array.isArray(opts.methods)\n        ? opts.methods.join(',')\n        : opts.methods\n\n      headers.set('Access-Control-Allow-Methods', methods)\n    }\n\n    getAllowedHeaders(req, opts.allowedHeaders).forEach(mergeHeaders)\n\n    if (typeof opts.maxAge === 'number') {\n      headers.set('Access-Control-Max-Age', String(opts.maxAge))\n    }\n\n    if (opts.preflightContinue) return res\n\n    headers.set('Content-Length', '0')\n    return new Response(null, { status: opts.optionsSuccessStatus, headers })\n  }\n\n  // If we got here, it's a normal request\n  return res\n}\n\nexport function initCors(options?: CorsOptions) {\n  return (req: Request, res: Response) => cors(req, res, options)\n}","import { ReactNode } from \"react\";\nimport { ApiError, buildClient } from \"@datocms/cma-client\";\nexport { default as cors } from './cors.js'\n\nexport const isServer = typeof window === 'undefined';\n\nexport const chunkArray = (array: any[] | ReactNode[], chunkSize: number) => {\n  const newArr = []\n  for (let i = 0; i < array.length; i += chunkSize)\n    newArr.push(array.slice(i, i + chunkSize));\n  return newArr\n}\n\nexport const parseDatoError = (err: any): string => {\n  const errors = (err as ApiError).errors.map(({ attributes: { code, details } }) => ({ code, field: details?.field, message: details?.message, detailsCode: details?.code, errors: Array.isArray(details?.errors) ? details?.errors.join('. ') : undefined }))\n  return errors.map(({ code, field, message, detailsCode, errors }) => `${code} ${field ? `(${field})` : ''} ${message || ''} ${detailsCode || ''} ${errors ? `(${errors})` : ''}`).join('\\n')\n}\n\nexport const isEmpty = (obj: any) => Object.keys(obj).filter(k => obj[k] !== undefined).length === 0\n\nexport const capitalize = (str: string, lower: boolean = false) => {\n  return (lower ? str.toLowerCase() : str).replace(/(?:^|\\s|[\"'([{])+\\S/g, match => match.toUpperCase());\n}\n\nexport const sleep = (ms: number) => new Promise((resolve, refject) => setTimeout(resolve, ms))\n\nexport const rInt = (min: number, max: number): number => {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nexport const truncateParagraph = (s: string, sentances: number = 1, ellipsis: boolean = true, minLength = 200): string => {\n  if (!s || s.length < minLength)\n    return s;\n\n  let dotIndex = s.split('.')?.slice(0, sentances + 1).join('.').lastIndexOf('.')\n  let qIndex = s.split('? ')?.slice(0, sentances + 1).join('? ').lastIndexOf('? ')\n  const isQuestion = qIndex !== -1 && qIndex < dotIndex || (dotIndex === -1 && qIndex > -1)\n\n  if (dotIndex === -1 && qIndex === -1) {\n    dotIndex = minLength - 1\n    ellipsis = true\n  }\n\n  let str = s.substring(0, isQuestion ? qIndex : dotIndex) //`${s.substring(0, minLength - 1)}${s.substring(minLength - 1).split('.').slice(0, sentances).join('. ')}`\n  return `${str}${ellipsis ? '...' : isQuestion ? '?' : '.'}`;\n}\n\nexport const truncateWords = (text: string, maxLength: number): string => {\n  if (text.length <= maxLength)\n    return text;\n\n  var truncatedText = text.substring(0, maxLength);\n  var lastSpaceIndex = truncatedText.lastIndexOf(' ');\n  if (lastSpaceIndex !== -1) {\n    truncatedText = truncatedText.substr(0, lastSpaceIndex);\n  }\n  return truncatedText + '...';\n}\n\nexport const sortSwedish = <T>(arr: T[], key?: string): T[] => {\n  const alfabet = [\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"I\", \"J\", \"K\", \"L\", \"M\", \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"U\", \"V\", \"W\", \"X\", \"Y\", \"Z\", \"Å\", \"Ä\", \"Ö\"];\n\n  return arr.sort((a, b) => {\n    const ai = alfabet.findIndex((l) => l === (key ? a[key] : a)?.charAt(0).toUpperCase())\n    const bi = alfabet.findIndex((l) => l === (key ? b[key] : b)?.charAt(0).toUpperCase())\n    return !ai ? -1 : ai > bi ? 1 : ai === bi ? 0 : -1\n  })\n}\n\nexport const awaitElement = async <T>(selector: string) => {\n\n  const cleanSelector = function (selector) {\n    (selector.match(/(#[0-9][^\\s:,]*)/g) || []).forEach(function (n) {\n      selector = selector.replace(n, '[id=\"' + n.replace(\"#\", \"\") + '\"]');\n    });\n    return selector;\n  }\n\n  for (let i = 0; i < 100; i++) {\n    const el = document.querySelector(cleanSelector(selector)) as T\n    if (el) return el\n    await sleep(30)\n  }\n\n  throw new Error(`Element ${selector} not found`)\n}"],"names":["cors","originHeadersFromReq","req","origin","value","reqOrigin","headers","Headers","set","append","isOriginAllowed","getOriginHeaders","get","undefined","Promise","resolve","then","_temp2","defaultOptions","methods","preflightContinue","optionsSuccessStatus","allowed","Array","isArray","some","o","RegExp","test","state","pact","s","_settle","bind","v","observer","_Pact","prototype","onFulfilled","onRejected","result","this","callback","e","_this","thenable","isServer","sleep","ms","refject","setTimeout","awaitElement","selector","_exit2","_temp3","_result","Error","i","_temp4","_for","_i","el","document","querySelector","match","forEach","n","replace","cleanSelector","reject","str","lower","toLowerCase","toUpperCase","array","chunkSize","newArr","length","push","slice","res","options","opts","_opts$origin","originHeaders","k","mergeHeaders","credentials","exposed","exposedHeaders","join","method","getAllowedHeaders","allowedHeaders","maxAge","String","Response","status","obj","Object","keys","filter","err","errors","map","_ref","_ref$attributes","attributes","details","code","field","message","detailsCode","_ref2","min","max","Math","ceil","floor","random","arr","key","alfabet","sort","a","b","ai","findIndex","l","_ref3","charAt","_ref4","bi","sentances","ellipsis","minLength","_s$split","_s$split2","dotIndex","split","lastIndexOf","qIndex","substring","isQuestion","text","maxLength","truncatedText","lastSpaceIndex","substr"],"mappings":"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"}