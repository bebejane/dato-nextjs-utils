import{ApolloClient as r,InMemoryCache as n,gql as e}from"@apollo/client/core/core.cjs";import{BatchHttpLink as t}from"@apollo/client/link/batch-http/batchHttpLink.js";function i(){return i=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r},i.apply(this,arguments)}var o,a;function u(r,n,e){if(!r.s){if(e instanceof c){if(!e.s)return void(e.o=u.bind(null,r,n));1&n&&(n=e.s),e=e.v}if(e&&e.then)return void e.then(u.bind(null,r,n),u.bind(null,r,2));r.s=n,r.v=e;var t=r.o;t&&t(r)}}var s="undefined"==typeof window,c=/*#__PURE__*/function(){function r(){}return r.prototype.then=function(n,e){var t=new r,i=this.s;if(i){var o=1&i?n:e;if(o){try{u(t,1,o(this.v))}catch(r){u(t,2,r)}return t}return this}return this.o=function(r){try{var i=r.v;1&r.s?u(t,1,n?n(i):i):e?u(t,1,e(i)):u(t,2,i)}catch(r){u(t,2,r)}},t},r}();function f(r){return r instanceof c&&1&r.s}var v=process.env.GRAPHQL_API_ENDPOINT||process.env.NEXT_PUBLIC_GRAPHQL_API_ENDPOINT||"https://graphql.datocms.com",l=process.env.NEXT_PUBLIC_GRAPHQL_API_TOKEN||process.env.GRAPHQL_API_TOKEN,h=null!=(o=null!=(a=process.env.DATOCMS_ENVIRONMENT)?a:process.env.NEXT_PUBLIC_DATOCMS_ENVIRONMENT)?o:"main",d=!!process.env.DATOCMS_INCLUDE_DRAFTS&&"true"===process.env.DATOCMS_INCLUDE_DRAFTS,p={uri:v,fetch:"true"===process.env.LOG_GRAPHQL?function(r,n){try{var e=n?JSON.parse(n.body.toString()):void 0,t=""+(e?Array.isArray(e)?e.map(function(r){return r.operationName}):[e.operationName]:[]).join(", ");return Promise.resolve(fetch(r,n)).then(function(r){var n=(new Date).getTime();return i({},r,{text:function(){try{return Promise.resolve(r.text()).then(function(r){return console.log("[33m%s[0m","gql  ","- "+t,"- "+((new Date).getTime()-n)+"ms"),r})}catch(r){return Promise.reject(r)}}})})}catch(r){return Promise.reject(r)}}:void 0,batchMax:10,batchInterval:50},b=function(r,n,e){void 0===r&&(r=!1),void 0===e&&(e=!0);var o={Authorization:"Bearer "+n,"X-Exclude-Invalid":e?"true":"false"};return(r||d)&&(o["X-Include-Drafts"]=!0),h&&(o["X-Environment"]=h),new t(i({},p,{headers:o}))},m=b(!1,l),y=b(!0,l),g=new r({link:m,cache:new n,ssrMode:s,defaultOptions:{query:{fetchPolicy:process.env.DEV_CACHE?"cache-first":"no-cache",errorPolicy:"all"}}}),w=function(r,n){try{var e=n||{},t=e.variables,o=e.preview,a=void 0!==o&&o,u=e.apiToken,s=e.excludeInvalid,c=void 0===s||s;if(null===r)throw new Error("Invalid query! Query is empty");if(!l&&!u)throw new Error("No graphql api token exists in .env");return Promise.resolve(function(n,e){try{var o=function(){g.setLink(u?b(a,u,c):a?y:m);var n=(Array.isArray(r)?r:[r]).map(function(r,n){var e=Array.isArray(t)&&t.length>n-1?t[n]:t||{};return g.query({query:r,variables:e})});return Promise.resolve(Promise.all(n)).then(function(r){var n=[];if(r.filter(function(r){return r.errors}).forEach(function(r){r.errors.map(function(r){return r.message}).forEach(function(r){return n.push(r)})}),n.length)throw new Error(n.join(". "));var e={};return r.forEach(function(r){return e=i({},e,null==r?void 0:r.data)}),e})}()}catch(r){return e(r)}return o&&o.then?o.then(void 0,e):o}(0,function(r){throw r}))}catch(r){return Promise.reject(r)}},P=function(r){var n=r.definitions.find(function(r){return"OperationDefinition"===r.kind});if(!n)throw new Error("Not a pagable query. Missing operation definition");var e=n.variableDefinitions;if(!n.selectionSet.selections.find(function(r){var n;return"pagination"===(null==(n=r.alias)?void 0:n.value)}))throw new Error("Not a pagable query. Missing pagination field");if(!e.find(function(r){return"first"===r.variable.name.value}))throw new Error("Not a pagable query. Missing $first variable");if(!e.find(function(r){return"skip"===r.variable.name.value}))throw new Error("Not a pagable query. Missing $skip variable");return!0},E=function(r,n,e){void 0===n&&(n={}),void 0===e&&(e={batchSize:50,delay:100});try{P(r);var t={},o=100;return Promise.resolve(w(r,{variables:i({},n.variables,{first:o,skip:0})})).then(function(a){var s;if(void 0===(null==(s=a.pagination)?void 0:s.count))throw new Error("Not a pagable query");var v=a.pagination.count,l=function(r){for(var n=Object.keys(r),e=0;e<n.length;e++){var i=n[e],o=r[n[e]];t[i]=Array.isArray(o)&&t[i]?t[i].concat(o):o}},h=function(r){return"rejected"===r.status};l(a);var d=[],p=o,b=function(r,n,e){for(var t;;){var i=r();if(f(i)&&(i=i.v),!i)return o;if(i.then){t=0;break}var o=e();if(o&&o.then){if(!f(o)){t=1;break}o=o.s}if(n){var a=n();if(a&&a.then&&!f(a)){t=2;break}}}var s=new c,v=u.bind(null,s,2);return(0===t?i.then(h):1===t?o.then(l):a.then(d)).then(void 0,v),s;function l(t){o=t;do{if(n&&(a=n())&&a.then&&!f(a))return void a.then(d).then(void 0,v);if(!(i=r())||f(i)&&!i.v)return void u(s,1,o);if(i.then)return void i.then(h).then(void 0,v);f(o=e())&&(o=o.v)}while(!o||!o.then);o.then(l).then(void 0,v)}function h(r){r?(o=e())&&o.then?o.then(l).then(void 0,v):l(o):u(s,1,o)}function d(){(i=r())?i.then?i.then(h).then(void 0,v):h(i):u(s,1,o)}}(function(){return p<v},function(){return!!(p+=o)},function(){return function(){if(!(d.length<e.batchSize&&p+o<v))return d.push(w(r,{variables:i({},n.variables,{first:o,skip:p})})),Promise.resolve(Promise.allSettled(d)).then(function(r){var n,t=null==(n=r.find(h))?void 0:n.reason;if(t)throw new Error(t);for(var i=0;i<r.length;i++)l(r[i].value);return Promise.resolve(new Promise(function(r){return setTimeout(r,e.delay)})).then(function(){d=[]})});d.push(w(r,{variables:i({},n.variables,{first:o,skip:p})}))}()});return b&&b.then?b.then(function(r){return t}):t})}catch(r){return Promise.reject(r)}},N=function(r,n){return e("query GetSEO{\n    seo: "+r+" "+(n?'( filter: { id: { eq: "'+n+'" } })':"")+" {\n      id \n      tags: _seoMetaTags {\n        attributes \n        content \n        tag\n      }\n    }\n  }")},A=function(r){return console.error(r),r.message||r};export{N as SEOQuery,w as apiQuery,E as apiQueryAll,P as checkIsPaganationQuery,g as client,A as datoError};
//# sourceMappingURL=index.modern.mjs.map
