import{ApolloClient as r,InMemoryCache as n,gql as e}from"@apollo/client/core/core.cjs";import{BatchHttpLink as t}from"@apollo/client/link/batch-http/batchHttpLink.js";function i(){return i=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r},i.apply(this,arguments)}var o,a;function u(r,n,e){if(!r.s){if(e instanceof c){if(!e.s)return void(e.o=u.bind(null,r,n));1&n&&(n=e.s),e=e.v}if(e&&e.then)return void e.then(u.bind(null,r,n),u.bind(null,r,2));r.s=n,r.v=e;var t=r.o;t&&t(r)}}var s="undefined"==typeof window,c=/*#__PURE__*/function(){function r(){}return r.prototype.then=function(n,e){var t=new r,i=this.s;if(i){var o=1&i?n:e;if(o){try{u(t,1,o(this.v))}catch(r){u(t,2,r)}return t}return this}return this.o=function(r){try{var i=r.v;1&r.s?u(t,1,n?n(i):i):e?u(t,1,e(i)):u(t,2,i)}catch(r){u(t,2,r)}},t},r}();function v(r){return r instanceof c&&1&r.s}var f=process.env.GRAPHQL_API_ENDPOINT||process.env.NEXT_PUBLIC_GRAPHQL_API_ENDPOINT||"https://graphql.datocms.com",h=process.env.NEXT_PUBLIC_GRAPHQL_API_TOKEN||process.env.GRAPHQL_API_TOKEN,l=null!=(o=null!=(a=process.env.DATOCMS_ENVIRONMENT)?a:process.env.NEXT_PUBLIC_DATOCMS_ENVIRONMENT)?o:"main",d=!!process.env.DATOCMS_INCLUDE_DRAFTS&&"true"===process.env.DATOCMS_INCLUDE_DRAFTS,p={uri:f,fetch:"true"===process.env.LOG_GRAPHQL?function(r,n){try{var e=n?JSON.parse(n.body.toString()):void 0,t=""+(e?Array.isArray(e)?e.map(function(r){return r.operationName}):[e.operationName]:[]).join(", ");return Promise.resolve(fetch(r,n)).then(function(r){var n=(new Date).getTime();return i({},r,{text:function(){try{return Promise.resolve(r.text()).then(function(r){return console.log("[33m%s[0m","gql  ","- "+t,"- "+((new Date).getTime()-n)+"ms"),r})}catch(r){return Promise.reject(r)}}})})}catch(r){return Promise.reject(r)}}:void 0,batchMax:10,batchInterval:50},m=function(r,n){void 0===r&&(r=!1);var e={Authorization:"Bearer "+n,"X-Exclude-Invalid":!0};return(r||d)&&(e["X-Include-Drafts"]=!0),l&&(e["X-Environment"]=l),new t(i({},p,{headers:e}))},y=m(!1,h),P=m(!0,h),b=new r({link:y,cache:new n,ssrMode:s,defaultOptions:{query:{fetchPolicy:process.env.DEV_CACHE?"cache-first":"no-cache",errorPolicy:"all"}}}),E=function(r,n){try{var e=n||{},t=e.variables,o=e.preview,a=void 0!==o&&o,u=e.apiToken;if(null===r)throw new Error("Invalid query! Query is empty");if(!h&&!u)throw new Error("No graphql api token exists in .env");return Promise.resolve(function(n,e){try{var o=function(){b.setLink(u?m(a,u):a?P:y);var n=(Array.isArray(r)?r:[r]).map(function(r,n){var e=Array.isArray(t)&&t.length>n-1?t[n]:t||{};return b.query({query:r,variables:e})});return Promise.resolve(Promise.all(n)).then(function(r){var n=[];if(r.filter(function(r){return r.errors}).forEach(function(r){r.errors.map(function(r){return r.message}).forEach(function(r){return n.push(r)})}),n.length)throw new Error(n.join(". "));var e={};return r.forEach(function(r){return e=i({},e,null==r?void 0:r.data)}),e})}()}catch(r){return e(r)}return o&&o.then?o.then(void 0,e):o}(0,function(r){throw r}))}catch(r){return Promise.reject(r)}},A=function(r,n,e){void 0===n&&(n={}),void 0===e&&(e={batchSize:50,delay:100});try{var t={},o=100;return Promise.resolve(E(r,{variables:i({},n.variables,{first:o,skip:0})})).then(function(a){var s;if(void 0===(null==(s=a.pagination)?void 0:s.count))throw new Error("Not a pagable query");var f=a.pagination.count,h=function(r){for(var n=Object.keys(r),e=0;e<n.length;e++){var i=n[e],o=r[n[e]];t[i]=Array.isArray(o)&&t[i]?t[i].concat(o):o}},l=function(r){return"rejected"===r.status};h(a);var d=[],p=o,m=function(r,n,e){for(var t;;){var i=r();if(v(i)&&(i=i.v),!i)return o;if(i.then){t=0;break}var o=e();if(o&&o.then){if(!v(o)){t=1;break}o=o.s}if(n){var a=n();if(a&&a.then&&!v(a)){t=2;break}}}var s=new c,f=u.bind(null,s,2);return(0===t?i.then(l):1===t?o.then(h):a.then(d)).then(void 0,f),s;function h(t){o=t;do{if(n&&(a=n())&&a.then&&!v(a))return void a.then(d).then(void 0,f);if(!(i=r())||v(i)&&!i.v)return void u(s,1,o);if(i.then)return void i.then(l).then(void 0,f);v(o=e())&&(o=o.v)}while(!o||!o.then);o.then(h).then(void 0,f)}function l(r){r?(o=e())&&o.then?o.then(h).then(void 0,f):h(o):u(s,1,o)}function d(){(i=r())?i.then?i.then(l).then(void 0,f):l(i):u(s,1,o)}}(function(){return p<f},function(){return!!(p+=o)},function(){return function(){if(!(d.length<e.batchSize&&p+o<f))return d.push(E(r,{variables:i({},n.variables,{first:o,skip:p})})),Promise.resolve(Promise.allSettled(d)).then(function(r){var n,t=null==(n=r.find(l))?void 0:n.reason;if(t)throw new Error(t);for(var i=0;i<r.length;i++)h(r[i].value);return Promise.resolve(new Promise(function(r){return setTimeout(r,e.delay)})).then(function(){d=[]})});d.push(E(r,{variables:i({},n.variables,{first:o,skip:p})}))}()});return m&&m.then?m.then(function(r){return t}):t})}catch(r){return Promise.reject(r)}},w=function(r,n){return e("query GetSEO{\n    seo: "+r+" "+(n?'( filter: { id: { eq: "'+n+'" } })':"")+" {\n      id \n      tags: _seoMetaTags {\n        attributes \n        content \n        tag\n      }\n    }\n  }")},g=function(r){return console.error(r),r.message||r};export{w as SEOQuery,E as apiQuery,A as apiQueryAll,b as client,g as datoError};
//# sourceMappingURL=index.modern.mjs.map
