!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@apollo/client/core/core.cjs"),require("@apollo/client/link/batch-http/batchHttpLink.js")):"function"==typeof define&&define.amd?define(["exports","@apollo/client/core/core.cjs","@apollo/client/link/batch-http/batchHttpLink.js"],n):n((e||self).api={},e.core_cjs,e.batchHttpLink_js)}(this,function(e,n,r){function t(){return t=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},t.apply(this,arguments)}var i,o;function a(e,n,r){if(!e.s){if(r instanceof s){if(!r.s)return void(r.o=a.bind(null,e,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(a.bind(null,e,n),a.bind(null,e,2));e.s=n,e.v=r;var t=e.o;t&&t(e)}}var u="undefined"==typeof window,s=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(n,r){var t=new e,i=this.s;if(i){var o=1&i?n:r;if(o){try{a(t,1,o(this.v))}catch(e){a(t,2,e)}return t}return this}return this.o=function(e){try{var i=e.v;1&e.s?a(t,1,n?n(i):i):r?a(t,1,r(i)):a(t,2,i)}catch(e){a(t,2,e)}},t},e}();function c(e){return e instanceof s&&1&e.s}var f=process.env.GRAPHQL_API_ENDPOINT||process.env.NEXT_PUBLIC_GRAPHQL_API_ENDPOINT||"https://graphql.datocms.com",l=process.env.NEXT_PUBLIC_GRAPHQL_API_TOKEN||process.env.GRAPHQL_API_TOKEN,v=null!=(i=null!=(o=process.env.DATOCMS_ENVIRONMENT)?o:process.env.NEXT_PUBLIC_DATOCMS_ENVIRONMENT)?i:"main",h=!!process.env.DATOCMS_INCLUDE_DRAFTS&&"true"===process.env.DATOCMS_INCLUDE_DRAFTS,p={uri:f,fetch:"true"===process.env.LOG_GRAPHQL?function(e,n){try{var r=n?JSON.parse(n.body.toString()):void 0,i=""+(r?Array.isArray(r)?r.map(function(e){return e.operationName}):[r.operationName]:[]).join(", ");return Promise.resolve(fetch(e,n)).then(function(e){var n=(new Date).getTime();return t({},e,{text:function(){try{return Promise.resolve(e.text()).then(function(e){return console.log("[33m%s[0m","gql  ","- "+i,"- "+((new Date).getTime()-n)+"ms"),e})}catch(e){return Promise.reject(e)}}})})}catch(e){return Promise.reject(e)}}:void 0,batchMax:10,batchInterval:50},d=function(e,n,i){void 0===e&&(e=!1),void 0===i&&(i=!0);var o={Authorization:"Bearer "+n,"X-Exclude-Invalid":i?"true":"false"};return(e||h)&&(o["X-Include-Drafts"]=!0),v&&(o["X-Environment"]=v),new r.BatchHttpLink(t({},p,{headers:o}))},y=d(!1,l),b=d(!0,l),g=new n.ApolloClient({link:y,cache:new n.InMemoryCache,ssrMode:u,defaultOptions:{query:{fetchPolicy:process.env.DEV_CACHE?"cache-first":"no-cache",errorPolicy:"all"}}}),m=function(e,n){try{var r=n||{},i=r.variables,o=r.preview,a=void 0!==o&&o,u=r.apiToken,s=r.excludeInvalid,c=void 0===s||s;if(null===e)throw new Error("Invalid query! Query is empty");if(!l&&!u)throw new Error("No graphql api token exists in .env");return Promise.resolve(function(n,r){try{var o=function(){g.setLink(u?d(a,u,c):a?b:y);var n=(Array.isArray(e)?e:[e]).map(function(e,n){var r=Array.isArray(i)&&i.length>n-1?i[n]:i||{};return g.query({query:e,variables:r})});return Promise.resolve(Promise.all(n)).then(function(e){var n=[];if(e.filter(function(e){return e.errors}).forEach(function(e){e.errors.map(function(e){return e.message}).forEach(function(e){return n.push(e)})}),n.length)throw new Error(n.join(". "));var r={};return e.forEach(function(e){return r=t({},r,null==e?void 0:e.data)}),r})}()}catch(e){return r(e)}return o&&o.then?o.then(void 0,r):o}(0,function(e){throw e}))}catch(e){return Promise.reject(e)}},w=function(e){var n=e.definitions.find(function(e){return"OperationDefinition"===e.kind});if(!n)throw new Error("Not a pagable query. Missing operation definition");var r=n.variableDefinitions;if(!n.selectionSet.selections.find(function(e){var n;return"pagination"===(null==(n=e.alias)?void 0:n.value)}))throw new Error("Not a pagable query. Missing pagination field");if(!r.find(function(e){return"first"===e.variable.name.value}))throw new Error("Not a pagable query. Missing $first variable");if(!r.find(function(e){return"skip"===e.variable.name.value}))throw new Error("Not a pagable query. Missing $skip variable");return!0};e.SEOQuery=function(e,r){return n.gql("query GetSEO{\n    seo: "+e+" "+(r?'( filter: { id: { eq: "'+r+'" } })':"")+" {\n      id \n      tags: _seoMetaTags {\n        attributes \n        content \n        tag\n      }\n    }\n  }")},e.apiQuery=m,e.apiQueryAll=function(e,n,r){void 0===n&&(n={}),void 0===r&&(r={batchSize:50,delay:100});try{w(e);var i={},o=100;return Promise.resolve(m(e,{variables:t({},n.variables,{first:o,skip:0})})).then(function(u){var f;if(void 0===(null==(f=u.pagination)?void 0:f.count))throw new Error("Not a pagable query");var l=u.pagination.count,v=function(e){for(var n=Object.keys(e),r=0;r<n.length;r++){var t=n[r],o=e[n[r]];i[t]=Array.isArray(o)&&i[t]?i[t].concat(o):o}},h=function(e){return"rejected"===e.status};v(u);var p=[],d=o,y=function(e,n,r){for(var t;;){var i=e();if(c(i)&&(i=i.v),!i)return o;if(i.then){t=0;break}var o=r();if(o&&o.then){if(!c(o)){t=1;break}o=o.s}if(n){var u=n();if(u&&u.then&&!c(u)){t=2;break}}}var f=new s,l=a.bind(null,f,2);return(0===t?i.then(h):1===t?o.then(v):u.then(p)).then(void 0,l),f;function v(t){o=t;do{if(n&&(u=n())&&u.then&&!c(u))return void u.then(p).then(void 0,l);if(!(i=e())||c(i)&&!i.v)return void a(f,1,o);if(i.then)return void i.then(h).then(void 0,l);c(o=r())&&(o=o.v)}while(!o||!o.then);o.then(v).then(void 0,l)}function h(e){e?(o=r())&&o.then?o.then(v).then(void 0,l):v(o):a(f,1,o)}function p(){(i=e())?i.then?i.then(h).then(void 0,l):h(i):a(f,1,o)}}(function(){return d<l},function(){return!!(d+=o)},function(){return function(){if(!(p.length<r.batchSize&&d+o<l))return p.push(m(e,{variables:t({},n.variables,{first:o,skip:d})})),Promise.resolve(Promise.allSettled(p)).then(function(e){var n,t=null==(n=e.find(h))?void 0:n.reason;if(t)throw new Error(t);for(var i=0;i<e.length;i++)v(e[i].value);return Promise.resolve(new Promise(function(e){return setTimeout(e,r.delay)})).then(function(){p=[]})});p.push(m(e,{variables:t({},n.variables,{first:o,skip:d})}))}()});return y&&y.then?y.then(function(e){return i}):i})}catch(e){return Promise.reject(e)}},e.checkIsPaganationQuery=w,e.client=g,e.datoError=function(e){return console.error(e),e.message||e}});
//# sourceMappingURL=index.umd.js.map
