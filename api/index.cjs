var r,e,n=require("@apollo/client/core/core.cjs"),t=require("@apollo/client/link/batch-http/batchHttpLink.js");function i(){return i=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r},i.apply(this,arguments)}function o(r,e,n){if(!r.s){if(n instanceof u){if(!n.s)return void(n.o=o.bind(null,r,e));1&e&&(e=n.s),n=n.v}if(n&&n.then)return void n.then(o.bind(null,r,e),o.bind(null,r,2));r.s=e,r.v=n;var t=r.o;t&&t(r)}}var a="undefined"==typeof window,u=/*#__PURE__*/function(){function r(){}return r.prototype.then=function(e,n){var t=new r,i=this.s;if(i){var a=1&i?e:n;if(a){try{o(t,1,a(this.v))}catch(r){o(t,2,r)}return t}return this}return this.o=function(r){try{var i=r.v;1&r.s?o(t,1,e?e(i):i):n?o(t,1,n(i)):o(t,2,i)}catch(r){o(t,2,r)}},t},r}();function s(r){return r instanceof u&&1&r.s}var c=process.env.GRAPHQL_API_ENDPOINT||process.env.NEXT_PUBLIC_GRAPHQL_API_ENDPOINT||"https://graphql.datocms.com",f=process.env.NEXT_PUBLIC_GRAPHQL_API_TOKEN||process.env.GRAPHQL_API_TOKEN,l=null!=(r=null!=(e=process.env.DATOCMS_ENVIRONMENT)?e:process.env.NEXT_PUBLIC_DATOCMS_ENVIRONMENT)?r:"main",v=!!process.env.DATOCMS_INCLUDE_DRAFTS&&"true"===process.env.DATOCMS_INCLUDE_DRAFTS,h={uri:c,fetch:"true"===process.env.LOG_GRAPHQL?function(r,e){try{var n=e?JSON.parse(e.body.toString()):void 0,t=""+(n?Array.isArray(n)?n.map(function(r){return r.operationName}):[n.operationName]:[]).join(", ");return Promise.resolve(fetch(r,e)).then(function(r){var e=(new Date).getTime();return i({},r,{text:function(){try{return Promise.resolve(r.text()).then(function(r){return console.log("[33m%s[0m","gql  ","- "+t,"- "+((new Date).getTime()-e)+"ms"),r})}catch(r){return Promise.reject(r)}}})})}catch(r){return Promise.reject(r)}}:void 0,batchMax:10,batchInterval:50},p=function(r,e){void 0===r&&(r=!1);var n={Authorization:"Bearer "+e,"X-Exclude-Invalid":"true"};return(r||v)&&(n["X-Include-Drafts"]=!0),l&&(n["X-Environment"]=l),new t.BatchHttpLink(i({},h,{headers:n}))},d=p(!1,f),y=p(!0,f),b=new n.ApolloClient({link:d,cache:new n.InMemoryCache,ssrMode:a,defaultOptions:{query:{fetchPolicy:process.env.DEV_CACHE?"cache-first":"no-cache",errorPolicy:"all"}}}),g=function(r,e){try{var n=e||{},t=n.variables,o=n.preview,a=void 0!==o&&o,u=n.apiToken;if(null===r)throw new Error("Invalid query! Query is empty");if(!f&&!u)throw new Error("No graphql api token exists in .env");return Promise.resolve(function(e,n){try{var o=function(){b.setLink(u?p(a,u):a?y:d);var e=(Array.isArray(r)?r:[r]).map(function(r,e){var n=Array.isArray(t)&&t.length>e-1?t[e]:t||{};return b.query({query:r,variables:n})});return Promise.resolve(Promise.all(e)).then(function(r){var e=[];if(r.filter(function(r){return r.errors}).forEach(function(r){r.errors.map(function(r){return r.message}).forEach(function(r){return e.push(r)})}),e.length)throw new Error(e.join(". "));var n={};return r.forEach(function(r){return n=i({},n,null==r?void 0:r.data)}),n})}()}catch(r){return n(r)}return o&&o.then?o.then(void 0,n):o}(0,function(r){throw r}))}catch(r){return Promise.reject(r)}},m=function(r){var e=r.definitions.find(function(r){return"OperationDefinition"===r.kind});if(!e)throw new Error("Not a pagable query. Missing operation definition");var n=e.variableDefinitions;if(!e.selectionSet.selections.find(function(r){var e;return"pagination"===(null==(e=r.alias)?void 0:e.value)}))throw new Error("Not a pagable query. Missing pagination field");if(!n.find(function(r){return"first"===r.variable.name.value}))throw new Error("Not a pagable query. Missing $first variable");if(!n.find(function(r){return"skip"===r.variable.name.value}))throw new Error("Not a pagable query. Missing $skip variable");return!0};exports.SEOQuery=function(r,e){return n.gql("query GetSEO{\n    seo: "+r+" "+(e?'( filter: { id: { eq: "'+e+'" } })':"")+" {\n      id \n      tags: _seoMetaTags {\n        attributes \n        content \n        tag\n      }\n    }\n  }")},exports.apiQuery=g,exports.apiQueryAll=function(r,e,n){void 0===e&&(e={}),void 0===n&&(n={batchSize:50,delay:100});try{m(r);var t={},a=100;return Promise.resolve(g(r,{variables:i({},e.variables,{first:a,skip:0})})).then(function(c){var f;if(void 0===(null==(f=c.pagination)?void 0:f.count))throw new Error("Not a pagable query");var l=c.pagination.count,v=function(r){for(var e=Object.keys(r),n=0;n<e.length;n++){var i=e[n],o=r[e[n]];t[i]=Array.isArray(o)&&t[i]?t[i].concat(o):o}},h=function(r){return"rejected"===r.status};v(c);var p=[],d=a,y=function(r,e,n){for(var t;;){var i=r();if(s(i)&&(i=i.v),!i)return a;if(i.then){t=0;break}var a=n();if(a&&a.then){if(!s(a)){t=1;break}a=a.s}if(e){var c=e();if(c&&c.then&&!s(c)){t=2;break}}}var f=new u,l=o.bind(null,f,2);return(0===t?i.then(h):1===t?a.then(v):c.then(p)).then(void 0,l),f;function v(t){a=t;do{if(e&&(c=e())&&c.then&&!s(c))return void c.then(p).then(void 0,l);if(!(i=r())||s(i)&&!i.v)return void o(f,1,a);if(i.then)return void i.then(h).then(void 0,l);s(a=n())&&(a=a.v)}while(!a||!a.then);a.then(v).then(void 0,l)}function h(r){r?(a=n())&&a.then?a.then(v).then(void 0,l):v(a):o(f,1,a)}function p(){(i=r())?i.then?i.then(h).then(void 0,l):h(i):o(f,1,a)}}(function(){return d<l},function(){return!!(d+=a)},function(){return function(){if(!(p.length<n.batchSize&&d+a<l))return p.push(g(r,{variables:i({},e.variables,{first:a,skip:d})})),Promise.resolve(Promise.allSettled(p)).then(function(r){var e,t=null==(e=r.find(h))?void 0:e.reason;if(t)throw new Error(t);for(var i=0;i<r.length;i++)v(r[i].value);return Promise.resolve(new Promise(function(r){return setTimeout(r,n.delay)})).then(function(){p=[]})});p.push(g(r,{variables:i({},e.variables,{first:a,skip:d})}))}()});return y&&y.then?y.then(function(r){return t}):t})}catch(r){return Promise.reject(r)}},exports.checkIsPaganationQuery=m,exports.client=b,exports.datoError=function(r){return console.error(r),r.message||r};
//# sourceMappingURL=index.cjs.map
