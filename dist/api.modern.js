import{ApolloClient as e,InMemoryCache as r,gql as t}from"@apollo/client/core/core.cjs";import{BatchHttpLink as a}from"@apollo/client/link/batch-http/batchHttpLink.js";function o(){return o=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},o.apply(this,arguments)}const n="undefined"==typeof window,s=process.env.GRAPHQL_API_ENDPOINT||process.env.NEXT_PUBLIC_GRAPHQL_API_ENDPOINT||"https://graphql.datocms.com",i=process.env.NEXT_PUBLIC_GRAPHQL_API_TOKEN,c={uri:s,fetch:process.env.LOG_GRAPHQL?async(e,r)=>{const t=r?JSON.parse(r.body.toString()):void 0,a=`${(t?Array.isArray(t)?t.map(e=>e.operationName):[t.operationName]:[]).join(", ")}`,n=await fetch(e,r),s=(new Date).getTime();return o({},n,{async text(){const e=await n.text();return console.log("[33m%s[0m","gql  ",`- ${a}`,`- ${(new Date).getTime()-s}ms`),e}})}:void 0,batchMax:10,batchInterval:50,headers:{Authorization:`Bearer ${i}`}},l=new a(c),h=new a(o({},c,{headers:o({},c.headers,{"X-Include-Drafts":!0})})),p=new e({link:l,cache:new r,ssrMode:n,defaultOptions:{query:{fetchPolicy:process.env.DEV_CACHE?"cache-first":"no-cache",errorPolicy:"all"}}}),y=e=>t("query GetSEO {seo: "+e+" {id tags: _seoMetaTags {attributes content tag}}}"),u=async(e,r)=>{const{variables:t,preview:a=!1}=r||{};if(null===e)throw new Error("Invalid query! Query is empty");if(!i)throw new Error("No graphql api token exists in .env");try{p.setLink(a?h:l);const r=(Array.isArray(e)?e:[e]).map((e,r)=>{const a=Array.isArray(t)&&t.length>r-1?t[r]:t||{};return p.query({query:e,variables:a})}),n=await Promise.all(r),s=[];if(n.filter(({errors:e})=>e).forEach(({errors:e})=>{e.map(e=>e.message).forEach(e=>s.push(e))}),s.length)throw new Error(s.join(". "));let i={};return n.forEach(e=>i=o({},i,null==e?void 0:e.data)),i}catch(e){throw e}};export{y as SEOQuery,u as apiQuery,p as client};
//# sourceMappingURL=api.modern.js.map
